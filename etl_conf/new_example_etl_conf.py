#-*-coding:UTF-8 -*-
#test at 213 home path
etl_op = {"run_mode":'day',
          "delay_hours":2,
          "jobs":[{"job_name":"job1",
                   "analysis":[{'etl_class_name':'ExtractionEtl',
                              'step_name':'mysql_e_1',
                              'db_type':'mysql',
                              'db_coninfo':[{'db_ip':'192.168.1.50','db_port':3306,'db_user':'jobs','db_passwd':'hhxxttxs','db_db':'test'}],
                              'db_path':'test.a2',
                              'pre_sql':[],
                              'post_sql':[],
                              'data_save_type':'SimpleOutput',
                              "sql_assemble":'SimpleAssemble',
                              'sql':'select * from test.a2 limit 30',
                              },],
                   "transform":[{'etl_class_name':'TransformEtl',
                                'step_name':'transform1',
                                'data_source':[{"job_name":"job1","step_name":'mysql_e_1','data_field':''},],
                                'data_transform_type':'SimpleTransform',
                                },],
                   "loading":[{'etl_class_name':'LoadingEtl',
                              'step_name':'load1',
                              'data_source':{"job_name":"job1","step_name":'transform1'},
                              'db_type':'mysql',
                              'db_coninfo':[{'db_ip':'192.168.1.50','db_port':3306,'db_user':'jobs','db_passwd':'hhxxttxs','db_db':'test'}],
                              'db_path':'test.a2',
                              'pre_sql':[],
                              'post_sql':[],
                              'data_load_type':'SplitLoad',
                              'data_field':'a|b'},]},
                  #####################################################################
                  ######*********************************************************######
                  #####################################################################
                  {"job_name":"job2",
                   "analysis":[{'etl_class_name':'ExtractionEtl',
                              'step_name':'hivecli_e_2',
                              'db_type':'hivecli',
                              'db_coninfo':[{'db_ip':'192.168.1.43','db_port':10000,'db_user':'','db_passwd':'','db_db':'test'}],
                              'db_path':'test.u_data',
                              'pre_sql':["set mapred.job.queue.name=ETL"],
                              'post_sql':[],
                              'data_save_type':'HivecliOutput',
                              "sql_assemble":'SimpleAssemble',
                              'sql':'select * from u_data limit 20',
                              },                      
                               {'etl_class_name':'ExtractionEtl',
                              'step_name':'hive_e_4',
                              'db_type':'hive',
                              'db_coninfo':[{'db_ip':'192.168.1.49','db_port':10000,'db_user':'','db_passwd':'','db_db':'test'}],
                              'db_path':'test.u_data',
                              'pre_sql':[],
                              'post_sql':[],
                              'data_save_type':'SimpleOutput',
                              "sql_assemble":'SimpleAssemble',
                              'sql':'select * from u_data limit 25',
                              },
                              {'etl_class_name':'ExtractionEtl',
                              'step_name':'hive_e_5',
                              'db_type':'hive',
                              'db_coninfo':[{'db_ip':'192.168.1.49','db_port':10000,'db_user':'','db_passwd':'','db_db':'active'}],
                              'db_path':'test.u_data',
                              'pre_sql':[],
                              'post_sql':[],
                              'data_save_type':'SimpleOutput',
                              "sql_assemble":'SimpleAssemble',
                              'sql':'select * from active_<!subdate(date,3)!> limit 25',
                              }],
                   "transform":[{'etl_class_name':'TransformEtl',
                                'step_name':'transform3',
                                'data_source':[{"job_name":"job2","step_name":'hive_e_4','data_field':'','path':''},{"job_name":"job2","step_name":'hivecli_e_2','data_field':'','path':''}],
                                'data_transform_type':'SimpleTransform',
                                }],
                   "loading":[{'etl_class_name':'LoadingEtl',
                              'step_name':'load4',
                              'data_source':{"job_name":"job2","step_name":'transform3'},
                              'db_type':'hive',
                              'db_coninfo':[{'db_ip':'192.168.1.49','db_port':10000,'db_user':'','db_passwd':'','db_db':'test'}],
                              'db_path':'test.u_data1',
                              'pre_sql':[],
                              'post_sql':[],
                              'data_load_type':'Internalload',
                              'data_field':'userid|movieid|rating|unixtime'},
                              {'etl_class_name':'LoadingEtl',
                              'step_name':'load5',
                              'data_source':{"job_name":"job2","step_name":'transform3'},
                              'db_type':'hivecli',
                              'db_coninfo':[{'db_ip':'','db_port':0,'db_user':'','db_passwd':'','db_db':'test'}],
                              'db_path':'/tmp/hivecli_etl_load',
                              'pre_sql':[],
                              'post_sql':[],
                              'data_load_type':'ExternalLoad',
                              'data_field':''},
                              {'etl_class_name':'LoadingEtl',
                              'step_name':'load6',
                              'data_source':{"job_name":"job2","step_name":'transform3'},
                              'db_type':'hivecli',
                              'db_coninfo':[{'db_ip':'','db_port':0,'db_user':'','db_passwd':'','db_db':'test'}],
                              'db_path':'test.u_data2',
                              'pre_sql':[],
                              'post_sql':[],
                              'data_load_type':'Internalload',
                              'data_field':'userid|movieid|rating|unixtime'},]},
                  #####################################################################
                  ######*********************************************************######
                  #####################################################################                                    
                  {"job_name":"job3",
                   "analysis":[{'etl_class_name':'ExtractionEtl',
                              'step_name':'mapred_e_3',
                              'db_type':'mapred',
                              'db_coninfo':[{'db_ip':'','db_port':0,'db_user':'','db_passwd':'','db_db':''}],
                              'db_path':'',
                              'pre_sql':[],
                              'post_sql':[],
                              'data_save_type':'MapredOutput',
                              "sql_assemble":'MapredRCAssemble',
                              'sql':'/opt/modules/hadoop/hadoop-0.20.203.0/bin/hadoop jar /opt/modules/hadoop/hadoop-0.20.203.0/contrib/streaming/hadoop-streaming-0.20.203.0.jar -inputformat com.hadoop.mapred.DeprecatedLzoTextInputFormat -mapper cat -reducer wc -input /data/dw/active/20120301/active_20120301_02_part-00000.lzo -output /tmp/%(conffile)s_%(job_name)s_%(step_name)s',
                              },],
                   "transform":[{'etl_class_name':'TransformEtl',
                                'step_name':'transform2',
                                'data_source':[{"job_name":"job3","step_name":'mapred_e_3','data_field':''},],
                                'data_transform_type':'SimpleTransform',
                                },],
                   "loading":[{'etl_class_name':'LoadingEtl',
                              'step_name':'load2',
                              'data_source':{"job_name":"job2","step_name":'transform3'},
                              'db_type':'mapred',
                              'db_coninfo':[{'db_ip':'','db_port':0,'db_user':'','db_passwd':'','db_db':''}],
                              'db_path':'/tmp/mapred_etl_load',
                              'pre_sql':[],
                              'post_sql':[],
                              'data_load_type':'ExternalLoad',
                              'data_field':''},]},
                  #####################################################################
                  ######*********************************************************######
                  #####################################################################
                  {"job_name":"job4",
                   "analysis":[{'etl_class_name':'ExtractionEtl',
                              'step_name':'mysql_e_2',
                              'db_type':'mysql',
                              'db_coninfo':[{'db_ip':'192.168.1.50','db_port':3306,'db_user':'jobs','db_passwd':'hhxxttxs','db_db':'test'}],
                              'db_path':'test.a1',
                              'pre_sql':[],
                              'post_sql':[],
                              'data_save_type':'SimpleOutput',
                              "sql_assemble":'SimpleAssemble',
                              'sql':'select * from test.a1 limit 30',
                              },],
                   "transform":[{'etl_class_name':'TransformEtl',
                                'step_name':'transform5',
                                'data_source':[{"job_name":"job4","step_name":'mysql_e_2','data_field':''},],
                                'data_transform_type':'SimpleTransform',
                                },],
                   "loading":[{'etl_class_name':'LoadingEtl',
                              'step_name':'load5',
                              'data_source':{"job_name":"job4","step_name":'transform5'},
                              'db_type':'mysql',
                              'db_coninfo':[{'db_ip':'192.168.1.50','db_port':3306,'db_user':'jobs','db_passwd':'hhxxttxs','db_db':'test'}],
                              'db_path':'test.a2',
                              'pre_sql':[],
                              'post_sql':[],
                              'data_load_type':'UpdateLoad',
                              'data_field':'a|b|c',
                              'update_data_field':'b|c',
                              'update_where_field':'a'},]},
                  #####################################################################
                  ######*********************************************************######
                  #####################################################################                                      
                  ],
          }
